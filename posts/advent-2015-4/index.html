<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.36.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Advent of Code 2015, Day 4: The Ideal Stocking Stuffer &middot; e3b0c442</title>

  
  <link type="text/css" rel="stylesheet" href="/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="/css/poole.css">
  <link type="text/css" rel="stylesheet" href="/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="e3b0c442" />

  
</head>

  <body class=" ">
  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="/"><h1>e3b0c442</h1></a>
      <p class="lead">
       Rants and ramblings of a bit mangler and electron herder. 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      
    </ul>

    <p>Â©2018 Nick. 85E3 8F69 046B 44C1 EC9F B07B 76D7 8F05 00D0 26C4</p>
  </div>
</div>

    <div class="content container">
    <div class="post">
  <h1>Advent of Code 2015, Day 4: The Ideal Stocking Stuffer</h1>
  <span class="post-date">Sat, Dec 22, 2018</span>
  <p>Santa spent so much time working on his efficiency, he&rsquo;s run out of time for
stocking-stuffers and has decided to start an initial coin offering instead.</p>

<blockquote>
<p>Santa needs help mining some AdventCoins (very similar to bitcoins) to use as gifts for all the economically forward-thinking little girls and boys.</p>

<p>To do this, he needs to find <a href="https://en.wikipedia.org/wiki/MD5">MD5</a> hashes which, in <a href="https://en.wikipedia.org/wiki/Hexadecimal">hexadecimal</a>, start with at least <strong>five zeroes</strong>. The input to the MD5 hash is some secret key (your puzzle input, given below) followed by a number in decimal. To mine AdventCoins, you must find Santa the lowest positive number (no leading zeroes: <code>1</code>, <code>2</code>, <code>3</code>, &hellip;) that produces such a hash.</p>

<p>For example:</p>

<ul>
<li>If your secret key is <code>abcdef</code>, the answer is <code>609043</code>, because the MD5 hash of <code>abcdef609043</code> starts with five zeroes (<code>000001dbbfa...</code>), and it is the lowest such number to do so.</li>
<li>If your secret key is <code>pqrstuv</code>, the lowest number it combines with to make an MD5 hash starting with five zeroes is <code>1048970</code>; that is, the MD5 hash of <code>pqrstuv1048970</code> looks like <code>000006136ef...</code>.</li>
</ul>
</blockquote>

<h2 id="analysis">Analysis</h2>

<p>
This problem is conceptually simple but difficult to place a complexity on.</p>

<p>For each increment of the numeric suffix, there are three basic operations that
need to take place:</p>

<ul>
<li>Build a string from the prefix and incremented suffix</li>
<li>Hash the combined string</li>
<li>Check the hash for the correct number of zeroes.</li>
</ul>

<p>To build the string, we can use a standard formatter such as <code>sprintf</code>.</p>

<p>Hashing the string can be done with your favorite crypto library; I chose
OpenSSL because of its ubiquity. Your language of choice (Go, Python, Rust all
fall into this category) may have an MD5 hashing function built into the
standard library.</p>

<p>Where you can have some fun is verifying the hash. The task is to verify that
the hexadecimal representation of the hash begins with five zeroes, but most
libraries only output a byte array. Our first instinct might be to format that
byte array into a string, and then check the first 5 characters of the string;
however, the conversion operation is relatively expensive. Since hexadecimal
format was specificed, we can verify the byte array itself! In a hexadecimal
formatted string, every two characters represent one byte. For five zeroes, this
means the first two and a half bytes (so, the first two bytes, and then the
higher-order bits on the third byte) need to be zero. So, we can check that
the first two bytes are zero, and that the third byte is less than 0x10. This
allows us to more efficiently verify the hash requirements.</p>

<p>When analyzing for complexity, our <em>n</em> in this case is one suffix. For each
suffix, we are building a string <em>O(n)</em>, hashing it <em>O(n)</em>, and then verifying
the hash <em>O(n)</em>, making an asymptotic complexity of <em>O(n)</em>. What we do not know,
however, is how many suffixes we&rsquo;ll need, which makes it effectively impossible
to determine how long the program will run.</p>

<h3 id="c">C</h3>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;openssl/md5.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>FILE <span style="color:#f92672">*</span>input <span style="color:#f92672">=</span> fopen(inputFile);

<span style="color:#66d9ef">char</span> prefix[<span style="color:#ae81ff">16</span>];
fgets(prefix, <span style="color:#ae81ff">16</span>, input);

<span style="color:#66d9ef">char</span> work[<span style="color:#ae81ff">64</span>];
<span style="color:#66d9ef">int</span> suffix <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> hash[MD5_DIGEST_LENGTH];

<span style="color:#66d9ef">while</span>(<span style="color:#ae81ff">1</span>) {
    suffix<span style="color:#f92672">++</span>;
    memset(work, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">64</span>);
    sprintf(work, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;%s%d&#34;</span>, prefix, suffix);
    MD5((<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)work, strlen(work), hash);
    <span style="color:#66d9ef">if</span>(hash[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> hash[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> hash[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x10</span>) {
        <span style="color:#66d9ef">break</span>;
    }
}</code></pre></div>

<h3 id="optimization">Optimization</h3>

<p>There are a couple of potential optimization avenues here.</p>

<p>Firstly is the string building. Formatters may not be the most efficient option
here; it is possible that manually converting the suffix integer to a string or
making the suffix a native string and &ldquo;incrementing&rdquo; it manually may be more
efficient than using a formatter.</p>

<p>Finding the fastest, rather than the most common, MD5 implementation will also
likely speed things up. Depending on your implementation, it may be backed by
assembly code that makes good use of registers and low-level caching.</p>

<hr />

<p>Apparently the AdventCoin mining difficulty has just been bumped up:</p>

<blockquote>
<p>Now find one that starts with six zeroes.</p>
</blockquote>

<h2 id="analysis-1">Analysis</h2>

<p>There is no change required in our algorithm, except for checking that the third
byte of the hash is 0 instead of &lt; 0x10.</p>

<p>Next: <a href="/posts/advent-2015-5/">Advent of Code 2015, Day 5: Doesn&rsquo;t He Have Intern-Elves For This?</a></p>
</div>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "e3b0c442" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

    
  </body>
</html>